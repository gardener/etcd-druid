---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.16.5
  name: etcdopstasks.druid.gardener.cloud
spec:
  group: druid.gardener.cloud
  names:
    kind: EtcdOpsTask
    listKind: EtcdOpsTaskList
    plural: etcdopstasks
    shortNames:
    - eot
    singular: etcdopstask
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .status.state
      name: State
      type: string
    - jsonPath: .spec.etcdName
      name: Etcd
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    - jsonPath: .status.phase
      name: Phase
      priority: 1
      type: string
    - jsonPath: .spec.ttlSecondsAfterFinished
      name: TTL
      priority: 1
      type: integer
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: |-
          EtcdOpsTask represents a task to perform operations on an Etcd cluster.
          It defines the desired configuration in Spec and tracks the observed state in Status.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: Spec defines the desired specification of the EtcdOpsTask.
            properties:
              config:
                description: |-
                  Config specifies the configuration for the operation to be performed.
                  Exactly one of the members of EtcdOpsTaskConfig must be set.
                maxProperties: 1
                minProperties: 1
                properties:
                  onDemandSnapshot:
                    description: OnDemandSnapshot defines the configuration for an
                      on-demand snapshot task.
                    properties:
                      isFinal:
                        description: IsFinal indicates whether the snapshot is marked
                          as final. This is subject to change.
                        type: boolean
                      timeoutSecondsDelta:
                        default: 60
                        description: |-
                          TimeoutSeconds is the timeout for the delta snapshot operation.
                          Defaults to 60 seconds.
                        format: int32
                        minimum: 1
                        type: integer
                      timeoutSecondsFull:
                        default: 480
                        description: |-
                          TimeoutSecondsFull is the timeout for full snapshot operations.
                          Defaults to 480 seconds (8 minutes).
                        format: int32
                        minimum: 1
                        type: integer
                      type:
                        description: |-
                          Type specifies whether the snapshot is a 'full' or 'delta' snapshot.
                          Use 'full' for a complete backup of the etcd database, or 'delta' for incremental changes since the last snapshot.
                        enum:
                        - full
                        - delta
                        type: string
                    required:
                    - type
                    type: object
                    x-kubernetes-validations:
                    - message: isFinal must be false (or omitted) when type is 'delta'
                      rule: 'self.type == ''delta'' ? !has(self.isFinal) || self.isFinal
                        == false : true'
                type: object
                x-kubernetes-validations:
                - message: config is immutable
                  rule: self == oldSelf
              etcdName:
                description: EtcdName refers to the name of the Etcd resource that
                  this task will operate on.
                type: string
                x-kubernetes-validations:
                - message: etcdName is immutable
                  rule: self == oldSelf
              ttlSecondsAfterFinished:
                default: 3600
                description: TTLSecondsAfterFinished is the duration in seconds after
                  which a finished task (status.state == Succeeded|Failed|Rejected)
                  will be garbage-collected.
                format: int32
                minimum: 1
                type: integer
                x-kubernetes-validations:
                - message: ttlSecondsAfterFinished is immutable
                  rule: self == oldSelf
            required:
            - config
            type: object
          status:
            description: Status defines the observed state of the EtcdOpsTask.
            properties:
              lastErrors:
                description: |-
                  LastErrors is a list of the most recent errors observed during the task's execution.
                  A maximum of 10 latest errors will be recorded.
                items:
                  description: LastError stores details of the most recent error encountered
                    for a resource.
                  properties:
                    code:
                      description: Code is an error code that uniquely identifies
                        an error.
                      type: string
                    description:
                      description: Description is a human-readable message indicating
                        details of the error.
                      type: string
                    observedAt:
                      description: ObservedAt is the time the error was observed.
                      format: date-time
                      type: string
                  required:
                  - code
                  - description
                  - observedAt
                  type: object
                maxItems: 10
                type: array
              lastOperation:
                description: |-
                  LastOperation tracks the fine-grained progress of the task's execution.
                  The controller initializes this field when processing the task.
                properties:
                  description:
                    description: Description describes the last operation.
                    type: string
                  lastUpdateTime:
                    description: LastUpdateTime is the time at which the operation
                      was last updated.
                    format: date-time
                    type: string
                  runID:
                    description: |-
                      RunID correlates an operation with a reconciliation run.
                      Every time an Etcd resource is reconciled (barring status reconciliation which is periodic), a unique ID is
                      generated which can be used to correlate all actions done as part of a single reconcile run. Capturing this
                      as part of LastOperation aids in establishing this correlation. This further helps in also easily filtering
                      reconcile logs as all structured logs in a reconciliation run should have the `runID` referenced.
                    type: string
                  state:
                    description: State is the state of the last operation.
                    type: string
                  type:
                    description: Type is the type of last operation.
                    type: string
                required:
                - description
                - lastUpdateTime
                - runID
                - state
                - type
                type: object
              lastTransitionTime:
                description: LastTransitionTime is the last time the state transitioned
                  from one value to another.
                format: date-time
                type: string
              phase:
                description: Phase represents the current phase of the task's lifecycle.
                enum:
                - Admit
                - Running
                - Cleanup
                type: string
              startedAt:
                description: StartedAt is the time at which the task transitioned
                  from Pending to InProgress.
                format: date-time
                type: string
              state:
                description: |-
                  State is the overall state of the task.
                  The controller initializes this field when processing the task.
                enum:
                - Pending
                - InProgress
                - Succeeded
                - Failed
                - Rejected
                type: string
            type: object
        required:
        - spec
        type: object
    served: true
    storage: true
    subresources:
      status: {}
